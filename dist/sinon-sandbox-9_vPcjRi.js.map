{"version":3,"file":"sinon-sandbox-9_vPcjRi.js","sources":["../src/test-support/sinon-sandbox.ts"],"sourcesContent":["import sinon from 'sinon';\nimport type { SinonFakeTimers, SinonSandbox, SinonSandboxConfig } from 'sinon';\n\ntype FakeTimerInstallOpts = SinonSandboxConfig['useFakeTimers'] extends\n  | boolean\n  | Partial<infer A>\n  ? A\n  : never;\n\nlet originalUseFakeTimers: SinonSandbox['useFakeTimers'];\nlet clockToRestore: SinonSandbox['clock'] | null;\n\n/**\n * Performs setup functionality for the sandbox before each test\n *\n * @public\n */\nexport function createSandbox() {\n  if (!originalUseFakeTimers) {\n    patchUseFakeTimers(sinon);\n  }\n}\n\n/**\n * Restores the sandbox & timers at the end of each test.\n *\n * @public\n */\nexport function restoreSandbox() {\n  if (clockToRestore) {\n    clockToRestore.restore();\n    clockToRestore = null;\n  }\n\n  sinon.restore();\n}\n\n/**\n * Patches the `useFakeTimers` method in `sinon` to ensure\n * created clocks are tracked and subsequently restored after\n * each test is complete. Calling this more than once within a single\n * test will result in an error thrown.\n *\n * @param {object} sandbox\n * @returns {object} a clock object returned from `useFakeTimers`\n */\nfunction patchUseFakeTimers(sandbox: SinonSandbox) {\n  originalUseFakeTimers = sandbox.useFakeTimers;\n  sandbox.useFakeTimers = function (\n    config?: number | Date | Partial<FakeTimerInstallOpts>,\n  ): SinonFakeTimers {\n    if (clockToRestore) {\n      throw new Error(\n        \"You called sinon's useFakeTimers multiple times within the same test. This can result in unknown behavior.\",\n      );\n    }\n    const clock = originalUseFakeTimers.apply(sandbox, [config]);\n\n    clockToRestore = clock;\n\n    return clock;\n  };\n}\n"],"names":["originalUseFakeTimers","clockToRestore","createSandbox","patchUseFakeTimers","sinon","restoreSandbox","restore","sandbox","useFakeTimers","config","Error","clock","apply"],"mappings":";;AASA,IAAIA,qBAAoD,CAAA;AACxD,IAAIC,cAA4C,CAAA;;AAEhD;AACA;AACA;AACA;AACA;AACO,SAASC,aAAaA,GAAG;EAC9B,IAAI,CAACF,qBAAqB,EAAE;IAC1BG,kBAAkB,CAACC,KAAK,CAAC,CAAA;AAC3B,GAAA;AACF,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,cAAcA,GAAG;AAC/B,EAAA,IAAIJ,cAAc,EAAE;IAClBA,cAAc,CAACK,OAAO,EAAE,CAAA;AACxBL,IAAAA,cAAc,GAAG,IAAI,CAAA;AACvB,GAAA;EAEAG,KAAK,CAACE,OAAO,EAAE,CAAA;AACjB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASH,kBAAkBA,CAACI,OAAqB,EAAE;EACjDP,qBAAqB,GAAGO,OAAO,CAACC,aAAa,CAAA;AAC7CD,EAAAA,OAAO,CAACC,aAAa,GAAG,UACtBC,MAAsD,EACrC;AACjB,IAAA,IAAIR,cAAc,EAAE;AAClB,MAAA,MAAM,IAAIS,KAAK,CACb,4GACF,CAAC,CAAA;AACH,KAAA;IACA,MAAMC,KAAK,GAAGX,qBAAqB,CAACY,KAAK,CAACL,OAAO,EAAE,CAACE,MAAM,CAAC,CAAC,CAAA;AAE5DR,IAAAA,cAAc,GAAGU,KAAK,CAAA;AAEtB,IAAA,OAAOA,KAAK,CAAA;GACb,CAAA;AACH;;;;"}